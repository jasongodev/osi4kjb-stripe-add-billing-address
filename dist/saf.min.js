/* Copyright 2023 Jason Go - Apache-2.0 */
"use strict";(()=>{var N=(t,r=12e4,n=[],h=[])=>{let b=setTimeout(()=>{y=()=>{}},r),y=()=>{document.readyState.length>7&&n.every(l=>Object.hasOwn(window,l))&&h.every(l=>document.querySelector(l))?(clearInterval(b),t()):setTimeout(y,9)};y()},s=t=>document.querySelector(t);var T=t=>{var r,n;return t.address={postal_code:s("#checkout_offer_extra_contact_information_address_zip").value,city:s("#checkout_offer_extra_contact_information_address_city").value,country:s("#input-address-country").value,line1:s("#checkout_offer_extra_contact_information_address_line_1").value,line2:s("#checkout_offer_extra_contact_information_address_line_2").value===""?s("#checkout_offer_extra_contact_information_address_line_1").value:s("#checkout_offer_extra_contact_information_address_line_2").value,state:(n=s("#checkout_offer_extra_contact_information_address_state"))==null?void 0:n.options[(r=s("#checkout_offer_extra_contact_information_address_state"))==null?void 0:r.selectedIndex].text},t};var q=()=>{/*! ========== KAJABI CODE STARTS HERE. COPYRIGHT BY KAJABI. ALL RIGHTS RESERVED. ========== *//*! Derived from https://kajabi-app-assets.kajabi-cdn.com/assets/checkout_manifest-beb59d57b2efd87b9ac8ac1f00432d86319f381c8387ca1af95d65307682494a.js */window.App.StripeElementsForm=function(t,r,n){function h(){var e={stripeAccount:n.stripeAccount,apiVersion:n.apiVersion};return l()&&(e.betas=["elements_enable_deferred_intent_beta_1"]),e}function b(){if(l()){var e={theme:"stripe",variables:{borderRadius:"4px",colorPrimary:n.checkoutPageColor,colorDanger:a.colorDanger,colorTextPlaceholder:a.placeholderColor,colorIcon:a.placeholderColor,fontSizeBase:a.fontSize,fontFamily:'-apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica Neue", "Arial", "Noto Sans", sans-serif',fontSmooth:"always",fontLineHeight:a.lineHeight},rules:{".Label":{fontWeight:"500",marginBottom:"8px"},".TabLabel":{fontWeight:"500"},".Input":{fontWeight:"400",borderColor:"#C7CFD8",boxShadow:"none",color:"#556370",padding:"6px 12px"},".Input::placeholder":{fontWeight:"400",fontFamily:'-apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica Neue", "Arial", "Noto Sans", sans-serif',letterSpacing:"0px",boxShadow:"none",color:"#748493"},".Input--invalid":{fontWeight:"400",fontFamily:'-apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica Neue", "Arial", "Noto Sans", sans-serif',letterSpacing:"0px",boxShadow:"none",borderColor:"#C7CFD8",color:"#556370"},".Error":{fontSize:"12px"}}};return{mode:"payment",paymentMethodTypes:x(),externalPaymentMethodTypes:n.acceptsPaypal&&g?["external_paypal"]:[],amount:Math.max(a.amount,50),currency:a.currency.toLowerCase(),appearance:e,locale:n.locale,fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Open+Sans:400,400i"},{family:"Circular",src:"url(https://sage.kajabi-cdn.com/fonts/circular/CircularXXWeb-Regular.woff2?v=1)",weight:"400"},{family:"Circular",src:"url(https://sage.kajabi-cdn.com/fonts/circular/CircularXXWeb-Bold.woff2?v=1)",weight:"700"}]}}return{locale:n.locale,fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Open+Sans:400,400i"}]}}function y(){return l()?"#payment-element":"#card-element"}function l(){return n.mode==="payment"||g}function x(){return g?n.additionalPaymentMethods.concat(["card"]):["card"]}function p(e){f.toggleClass(ee,e)}function W(){!j&&te&&M&&(j=!0,ktag("event","add_payment_info",M))}function C(){t.attr("data-return-to")&&window.location.replace(t.attr("data-return-to"))}function u(e){if(m.length){var o=$(m).find("input[type='checkbox']");m.hide()}if(e.error)p(!0),X(e),P(e),C();else if(e.setupIntent){p(!1);var i=e.setupIntent.payment_method;a.paymentMethodField.val(i),t[0].submit()}else if(e.paymentMethod){p(!1);var i=e.paymentMethod;a.paymentMethodField.val(i.id),l()&&(window.currentSelection!=="external_paypal"&&$("#checkout_offer_payment_method_type").val(i.type),window.currentSelection!=="card"&&$("#checkout_offer_consent_to_store_payment_method").val(0)),t[0].submit()}else e.complete&&window.currentSelection==="card"&&(p(!1),K(o),m.show(),W(event))}function _(e,o){if(e.error)e.error.type==="invalid_request_error"&&e.error.code==="payment_intent_authentication_failure"?o?H():G():u(e);else if(e.paymentIntent){p(!1);var i=e.paymentIntent.id;a.paymentIntentField.val(i),t[0].submit()}else u(e)}function X(e){window.App.flashError({text:e.error.message}),setTimeout(function(){$.rails.enableFormElements(t)},100)}function P(e){var o;t.find("input.email")[0]&&(o=t.find("input.email").val());var i={stripe_elements_error_report:{email:o,stripe_result:e}};$.post("/stripe_elements_error_reports.json",i)}function J(e){e.brand!==L&&(f.trigger("card-brand-change",e.brand),L=e.brand)}function E(e,o){e.confirmation_method==="manual"?c.handleCardAction(S).then(function(i){_(i,o)}):c.handleCardPayment(S).then(function(i){_(i,o)})}function F(e,o){c.retrievePaymentIntent(e).then(function(i){i.paymentIntent&&i.paymentIntent.status==="requires_action"?E(i.paymentIntent,o):i.paymentIntent&&i.paymentIntent.status==="requires_confirmation"?H():u(i)})}function U(){window.ApplePaySession&&x().indexOf("apple_pay")>=0&&V()}function V(){var e=CLIENT_INFO.offer_token;e&&$.ajax({type:"POST",url:"/offers/"+e+"/checkout/verify_apple_pay_domain",data:{domain:window.location.host}}).done(function(o){o.verified===!0&&t.attr("data-kp-ap-verified",!0)})}function H(){$.ajax({url:t.attr("action"),method:"POST",dataType:"json",data:t.serialize()}).done(function(e){e.paymentIntent&&e.paymentIntent.status==="requires_action"?E(e.paymentIntent,!1):_(e,!1)})}function G(){$.ajax({url:t.attr("action").replace("confirm","cancel"),method:"POST",dataType:"json",data:t.serialize()}).done(function(e){e.paymentIntent&&e.paymentIntent.status==="canceled"?C():_(e,!1)})}function K(e){m.length&&e.prop("checked",Y)}function Q(){var e={hidePostalCode:ne,iconStyle:"solid",style:{base:{iconColor:a.placeholderColor,color:a.color,lineHeight:a.lineHeight,fontSize:a.fontSize,fontFamily:'"Open Sans", sans-serif',fontWeight:"normal",fontSmoothing:"antialiased","::placeholder":{fontFamily:'"Open Sans", sans-serif',color:a.placeholderColor,iconColor:a.placeholderColor}},invalid:{color:a.colorDanger,iconColor:a.colorDanger}}};return v.create("card",e)}function A(e){P({readyState:document.readyState,elementType:l()?"payment":"card",error:e,stripeJsVersion:c&&c.version,analyticsOptions:M,paymentMethods:x(),additionalPaymentMethods:n.additionalPaymentMethods,stripeAccount:n.stripeAccount,stripeTimeoutPromptEnabled:n.stripeElementTimeoutPrompt})}function Z(){var e=v.create("payment",{layout:{type:g?"accordion":"tabs",defaultCollapsed:!0,radios:!0,spacedAccordionItems:!1},business:{name:n.siteName},fields:{billingDetails:{email:"never"}},wallets:{googlePay:n.additionalPaymentMethods&&n.additionalPaymentMethods.indexOf("google_pay")>=0?"auto":"never",applePay:n.additionalPaymentMethods&&n.additionalPaymentMethods.indexOf("apple_pay")>=0?"auto":"never"}});return e.on("change",function(o){window.currentSelection,o.value.type,window.currentSelection=o.value.type,$(document).trigger(window.currentSelection==="external_paypal"?"kjb:checkout:paypalSelected":"kjb:checkout:otherSelected"),m.hide()}),e}this.$eventBus=$(document);var a=$.extend({color:"#151515",colorDanger:"#e2422d",fontSize:"14px",paymentMethodField:t.find("[data-stripe-payment-method]").first(),paymentIntentField:t.find("[data-stripe-payment-intent]").first(),lineHeight:"36px",placeholderColor:"#999999"},n);this.$opts=a;var g=n.additionalPaymentMethods&&n.additionalPaymentMethods.length>0,O=y(),f=$(O),m=$("#manage_payment_method"),k=$("#checkout_offer_offer_price_override"),Y=m.prop("checked"),ee="card-element-has-error",c=typeof Stripe=="undefined"?null:Stripe(r,h()),v=c&&c.elements(b());this.$elements=v;var d,L,te=document.querySelector(".offer-checkout--analytics")!==null,M=n.analyticsOptions,ne=a.hidePostalCode==="true",j=!1;if(window.currentSelection="card",this.$completionRequired=!1,c||A({code:"stripe_js_not_loaded",message:"Stripe JS was loaded not at time of elements form initialization"}),f.length){n.stripeElementTimeoutPrompt&&t.find("input.btn").attr("disabled",!0),setTimeout(function(){window.stripeReady||(A({code:"initialization_timeout",message:"Did not receive ready from element within expected time"}),n.stripeElementTimeoutPrompt&&window.App.flashError({text:n.stripeElementTimeoutPromptMessage}))},1e4);var d=l()?Z():Q();if(d.mount(O),l()&&U(),document.querySelector(".offer-checkout--preview")!==null&&document.querySelector(".offer-checkout-next-gen")!==null)return;d.on("ready",function(){t.find("input.btn").attr("disabled",!1),window.stripeReady=!0}),d.on("change",function(o){f.trigger("card-change",o),u(o),J(o)}),f.on("card-reset",function(){p(!1),d.clear(),d.focus()}),f.on("card-error",function(){p(!0)})}if(k.length&&l()&&k.on("change keyup paste",function(){var e=Number($(k).val()),o=Math.floor(Math.max(e*Math.pow(10,n.exponent),50));v.update({amount:o})}),l()&&(this.$eventBus.on("kjb:checkout:coupon:applied",this.onCouponApplied.bind(this)),this.$eventBus.on("kjb:checkout:coupon:removed",this.onCouponRemoved.bind(this)),this.$eventBus.on("kjb:checkoutPaymentStepComplete",this.onPaymentStepComplete.bind(this)),this.$eventBus.on("kjb:checkoutPaymentStepIncomplete",this.onPaymentStepIncomplete.bind(this))),t.on("submit",function(e){if((!l()||this.$completionRequired)&&!(window.kjbStripeElementSkip||window.currentSelection==="external_paypal"||window.giftCouponApplied||window.freePwyw)){e.preventDefault(),$.rails.disableFormElements(t);var o={};t.find('input[data-stripe="name"]')[0]&&(o.name=t.find('input[data-stripe="name"]').val()),t.find('input[data-stripe="address_zip"]')[0]&&(o.address={postal_code:t.find('input[data-stripe="address_zip"]').val()}),o.email=t.find('input[type="email"]').val(),n.intent?c.handleCardSetup(n.intent,d,{payment_method_data:{billing_details:T(o)}}).then(u):d?c.createPaymentMethod("card",d,{billing_details:T(o)}).then(u):t[0].submit()}}.bind(this)),t.attr("data-payment-intent-client-secret")){var S=t.attr("data-payment-intent-client-secret"),R=t.attr("data-reconfirmable")==="true";t.attr("data-automatic-confirmation")&&F(S,R),$("[data-confirm-stripe-payment-intent]").on("click",function(){event.preventDefault(),F(S,R)})}},window.App.StripeElementsForm.bindTo=function(t){var r=$(t),n=r.closest("form"),h=JSON.parse(r.attr("data-stripe-elements-options")||"{}");new window.App.StripeElementsForm(n,r.attr("data-stripe-elements-form"),h)},window.App.StripeElementsForm.prototype={onCouponApplied:function(t,r){this.$elements.update({amount:Math.max(r.due_now_price,50)})},onCouponRemoved:function(){this.$elements.update({amount:Math.max(this.$opts.amount,50)})},onPaymentStepComplete:function(){this.$completionRequired=!1},onPaymentStepIncomplete:function(){this.$completionRequired=!0,window.currentSelection==="external_paypal"&&$(document).trigger("kjb:checkout:paypalSelected")}},$(function(){$("[data-stripe-elements-form]").each(function(t,r){window.App.StripeElementsForm.bindTo(r)})});/*! ========== KAJABI CODE ENDS HERE. COPYRIGHT BY KAJABI. ALL RIGHTS RESERVED. ========== */};var z,w=Object.assign({enabledOffers:"",disabledOffers:""},(z=document.currentScript)==null?void 0:z.dataset),B,D,I=(D=(B=window.location.href.match(/\/offers\/(.{8})/))==null?void 0:B[1])!=null?D:"";I!==""&&!w.disabledOffers.split(/\s*[,|]\s*/).includes(I)&&(w.enabledOffers===""||w.enabledOffers!==""&&w.enabledOffers.split(/\s*[,|]\s*/).includes(I))&&N(q,1e4,["$","App","Stripe"],["#checkout_offer_extra_contact_information_address_zip"]);})();
//# sourceMappingURL=saf.min.js.map
