{
  "version": 3,
  "sources": ["../src/utils.ts", "../src/addAddress.ts", "../src/index.ts", "../src/iife.ts"],
  "sourcesContent": ["/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const domReady = (callback: Function, wait: number = 120000, objects: string[] = [], selectors: string[] = []): void => {\n  const ctrl = setTimeout(() => {\n    checkReady = () => {}\n  }, wait)\n\n  let checkReady = (): void => {\n    if (\n      document.readyState.length > 7 &&\n      objects.every((key) => Object.hasOwn(window, key)) &&\n      selectors.every((selector) => document.querySelector(selector))\n    ) {\n      clearInterval(ctrl)\n      callback()\n    } else {\n      setTimeout(checkReady, 9)\n    }\n  }\n\n  checkReady()\n}\n\nexport const $ = <T extends keyof HTMLElementTagNameMap | string>(\n  s: T\n): T extends keyof HTMLElementTagNameMap ? HTMLElementTagNameMap[T] | null : HTMLElement | null => {\n  return document.querySelector(s) as T extends keyof HTMLElementTagNameMap ? HTMLElementTagNameMap[T] : HTMLElement | null\n}\n\nexport interface CustomWindow extends Window {\n  App: any\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { $ } from './utils'\n\nexport const addAddress = (billingDetails: Record<string, any>): Record<string, any> => {\n  billingDetails.address = {\n    postal_code: ($('#checkout_offer_extra_contact_information_address_zip') as HTMLInputElement).value,\n    city: ($('#checkout_offer_extra_contact_information_address_city') as HTMLInputElement).value,\n    country: ($('#input-address-country') as HTMLInputElement).value,\n    line1: ($('#checkout_offer_extra_contact_information_address_line_1') as HTMLInputElement).value,\n    line2:\n      ($('#checkout_offer_extra_contact_information_address_line_2') as HTMLInputElement).value === ''\n        ? ($('#checkout_offer_extra_contact_information_address_line_1') as HTMLInputElement).value\n        : ($('#checkout_offer_extra_contact_information_address_line_2') as HTMLInputElement).value,\n    state: ($('#checkout_offer_extra_contact_information_address_state') as HTMLSelectElement)?.options[\n      ($('#checkout_offer_extra_contact_information_address_state') as HTMLSelectElement)?.selectedIndex\n    ].text\n  }\n  return billingDetails\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/* eslint-disable @typescript-eslint/no-implied-eval */\n/* eslint-disable no-new-func */\n\nimport { domReady, CustomWindow } from './utils'\nimport { addAddress } from './addAddress'\n\ndeclare const window: CustomWindow\naddAddress({})\n\nconst config = Object.assign(\n  {\n    enabledOffers: '',\n    disabledOffers: ''\n  },\n  document.currentScript?.dataset\n)\n\nconst offerSlug = window.location.href.match(/\\/offers\\/(.{8})/)?.[1] ?? ''\n\nconst patch = (): void => {\n  let serializedConstructor: string = window.App.StripeElementsForm.toString()\n  const serializedBindTo: string = window.App.StripeElementsForm.bindTo.toString()\n\n  serializedConstructor = serializedConstructor.replace(/billing_details\\s*:\\s*(.+?)\\s*}/g, 'billing_details: addAddress($1) }')\n\n  window.App.StripeElementsForm = new Function('f', 's', 'o', `(${serializedConstructor})(f,s,o)`)\n  window.App.StripeElementsForm.bindTo = new Function('e', `(${serializedBindTo})(e)`)\n\n  document.querySelectorAll('[data-stripe-elements-form]').forEach((el) => window.App.StripeElementsForm.bindTo(el))\n}\n\nexport const stripeAddBillingAddress = (): void => {\n  if (\n    // Not a checkout page\n    offerSlug === '' ||\n    // Or included in disabled offers\n    config.disabledOffers.split(/\\s*[,|]\\s*/).includes(offerSlug) ||\n    // Or not included in enabled offers\n    (config.enabledOffers !== '' && !config.enabledOffers.split(/\\s*[,|]\\s*/).includes(offerSlug))\n  ) {\n    return\n  }\n  domReady(\n    // Run the patched code\n    patch,\n    // But limit waiting for 10 seconds...\n    10000,\n    // For these objects to exist before running the patched code\n    ['$', 'App', 'Stripe'],\n    // And run only when address fields are present\n    ['#checkout_offer_extra_contact_information_address_zip']\n  )\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { stripeAddBillingAddress } from '.'\nstripeAddBillingAddress()\n"],
  "mappings": ";mBAkBO,IAAMA,EAAW,CAACC,EAAoBC,EAAe,KAAQC,EAAoB,CAAC,EAAGC,EAAsB,CAAC,IAAY,CAC7H,IAAMC,EAAO,WAAW,IAAM,CAC5BC,EAAa,IAAM,CAAC,CACtB,EAAGJ,CAAI,EAEHI,EAAa,IAAY,CAEzB,SAAS,WAAW,OAAS,GAC7BH,EAAQ,MAAOI,GAAQ,OAAO,OAAO,OAAQA,CAAG,CAAC,GACjDH,EAAU,MAAOI,GAAa,SAAS,cAAcA,CAAQ,CAAC,GAE9D,cAAcH,CAAI,EAClBJ,EAAS,GAET,WAAWK,EAAY,CAAC,CAE5B,EAEAA,EAAW,CACb,EAEaG,EACXC,GAEO,SAAS,cAAcA,CAAC,ECtB1B,IAAMC,EAAcC,GAA6D,CApBxF,IAAAC,EAAAC,EAqBE,OAAAF,EAAe,QAAU,CACvB,YAAcG,EAAE,uDAAuD,EAAuB,MAC9F,KAAOA,EAAE,wDAAwD,EAAuB,MACxF,QAAUA,EAAE,wBAAwB,EAAuB,MAC3D,MAAQA,EAAE,0DAA0D,EAAuB,MAC3F,MACGA,EAAE,0DAA0D,EAAuB,QAAU,GACzFA,EAAE,0DAA0D,EAAuB,MACnFA,EAAE,0DAA0D,EAAuB,MAC1F,OAAQD,EAAAC,EAAE,yDAAyD,IAA3D,YAAAD,EAAoF,SACzFD,EAAAE,EAAE,yDAAyD,IAA3D,YAAAF,EAAoF,eACrF,IACJ,EACOD,CACT,ECVAI,EAAW,CAAC,CAAC,EAzBb,IAAAC,EA2BMC,EAAS,OAAO,OACpB,CACE,cAAe,GACf,eAAgB,EAClB,GACAD,EAAA,SAAS,gBAAT,YAAAA,EAAwB,OAC1B,EAjCAA,EAAAE,EAmCMC,GAAYD,GAAAF,EAAA,OAAO,SAAS,KAAK,MAAM,kBAAkB,IAA7C,YAAAA,EAAiD,KAAjD,KAAAE,EAAuD,GAEnEE,EAAQ,IAAY,CACxB,IAAIC,EAAgC,OAAO,IAAI,mBAAmB,SAAS,EACrEC,EAA2B,OAAO,IAAI,mBAAmB,OAAO,SAAS,EAE/ED,EAAwBA,EAAsB,QAAQ,mCAAoC,mCAAmC,EAE7H,OAAO,IAAI,mBAAqB,IAAI,SAAS,IAAK,IAAK,IAAK,IAAIA,CAAqB,UAAU,EAC/F,OAAO,IAAI,mBAAmB,OAAS,IAAI,SAAS,IAAK,IAAIC,CAAgB,MAAM,EAEnF,SAAS,iBAAiB,6BAA6B,EAAE,QAASC,GAAO,OAAO,IAAI,mBAAmB,OAAOA,CAAE,CAAC,CACnH,EAEaC,EAA0B,IAAY,CAG/CL,IAAc,IAEdF,EAAO,eAAe,MAAM,YAAY,EAAE,SAASE,CAAS,GAE3DF,EAAO,gBAAkB,IAAM,CAACA,EAAO,cAAc,MAAM,YAAY,EAAE,SAASE,CAAS,GAI9FM,EAEEL,EAEA,IAEA,CAAC,IAAK,MAAO,QAAQ,EAErB,CAAC,uDAAuD,CAC1D,CACF,ECnDAM,EAAwB",
  "names": ["domReady", "callback", "wait", "objects", "selectors", "ctrl", "checkReady", "key", "selector", "$", "s", "addAddress", "billingDetails", "_a", "_b", "$", "addAddress", "_a", "config", "_b", "offerSlug", "patch", "serializedConstructor", "serializedBindTo", "el", "stripeAddBillingAddress", "domReady", "stripeAddBillingAddress"]
}
