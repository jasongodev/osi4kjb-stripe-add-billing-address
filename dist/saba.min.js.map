{
  "version": 3,
  "sources": ["../src/utils.ts", "../src/addAddress.ts", "../src/index.ts", "../src/iife.ts"],
  "sourcesContent": ["/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const doc = document\n\nexport const $ = <T extends keyof HTMLElementTagNameMap | string>(\n  s: T\n): T extends keyof HTMLElementTagNameMap ? HTMLElementTagNameMap[T] | null : HTMLElement | null => {\n  return doc.querySelector(s) as T extends keyof HTMLElementTagNameMap ? HTMLElementTagNameMap[T] : HTMLElement | null\n}\n\nexport const domReady = (callback: Function, wait: number = 120000, objects: string[] = [], selectors: string[] = []): void => {\n  const ctrl = setTimeout(() => {\n    checkReady = () => {}\n  }, wait)\n\n  let checkReady = (): void => {\n    if (doc.readyState.length > 7 && objects.every((key) => Object.hasOwn(window, key)) && selectors.every((selector) => $(selector))) {\n      clearInterval(ctrl)\n      callback()\n    } else {\n      setTimeout(checkReady, 9)\n    }\n  }\n\n  checkReady()\n}\n\nexport interface CustomWindow extends Window {\n  App: any\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { $ } from './utils'\n\nexport const addressStr = '#checkout_offer_extra_contact_information_address'\n\nexport const addAddress = (billingDetails: Record<string, any>): Record<string, any> => {\n  const value = 'value'\n  billingDetails.address = {\n    postal_code: ($(addressStr + '_zip') as HTMLInputElement)[value],\n    city: ($(addressStr + '_city') as HTMLInputElement)[value],\n    country: ($('#input-address-country') as HTMLInputElement)[value],\n    line1: ($(addressStr + '_line_1') as HTMLInputElement)[value],\n    line2:\n      ($(addressStr + '_line_2') as HTMLInputElement)[value] === ''\n        ? ($(addressStr + '_line_1') as HTMLInputElement)[value]\n        : ($(addressStr + '_line_2') as HTMLInputElement)[value],\n    state: ($(addressStr + '_state') as HTMLSelectElement)?.options[($(addressStr + '_state') as HTMLSelectElement)?.selectedIndex].text\n  }\n  return billingDetails\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/* eslint-disable @typescript-eslint/no-implied-eval */\n/* eslint-disable no-new-func */\n\nimport { domReady, CustomWindow, doc } from './utils'\nimport { addAddress, addressStr } from './addAddress'\n\ndeclare const window: CustomWindow\n\nconst patch = (app = window.App): void => {\n  const originalConstructor = app.StripeElementsForm\n\n  let serializedConstructor: string = originalConstructor.toString()\n  serializedConstructor = serializedConstructor.replace(/{\\s*b(.+?)s\\s*:\\s*(.+?)\\s*}/g, '{b$1s:App.SABA($2)}')\n\n  const newConstructor = new Function('f', 's', 'o', `(${serializedConstructor})(f,s,o)`)\n\n  // @ts-expect-error\n  newConstructor.bindTo = originalConstructor.bindTo\n  newConstructor.prototype = originalConstructor.prototype\n  app.StripeElementsForm = newConstructor\n  app.SABA = addAddress\n\n  // @ts-expect-error\n  doc.querySelectorAll('[data-stripe-elements-form]').forEach((el) => newConstructor.bindTo(el))\n}\n\nexport const stripeAddBillingAddress = (): void => {\n  const offerSlug = window.location.href.match(/\\/offers\\/(.{8})/)?.[1]\n  const separator = /\\s*[,|]\\s*/\n  const enabledOffers = 'enabledOffers'\n  const disabledOffers = 'disabledOffers'\n\n  const config = Object.assign(\n    {\n      [enabledOffers]: '',\n      [disabledOffers]: ''\n    },\n    doc.currentScript?.dataset\n  )\n\n  if (\n    // Not a checkout page\n    offerSlug === undefined ||\n    // Or included in disabled offers\n    config[disabledOffers].split(separator).includes(offerSlug) ||\n    // Or not included in enabled offers\n    (config[enabledOffers] !== '' && !config[enabledOffers].split(separator).includes(offerSlug))\n  ) {\n    return\n  }\n\n  domReady(\n    // Run the patched code\n    patch,\n    // But limit waiting for 10 seconds...\n    10000,\n    // For these objects to exist before running the patched code\n    ['$', 'App', 'Stripe'],\n    // And run only when address fields are present\n    [addressStr + '_zip']\n  )\n}\n", "/**\n * Copyright 2023 Jason Go\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { stripeAddBillingAddress } from '.'\nstripeAddBillingAddress()\n"],
  "mappings": ";mBAkBO,IAAMA,EAAM,SAENC,EACXC,GAEOF,EAAI,cAAcE,CAAC,EAGfC,EAAW,CAACC,EAAoBC,EAAe,KAAQC,EAAoB,CAAC,EAAGC,EAAsB,CAAC,IAAY,CAC7H,IAAMC,EAAO,WAAW,IAAM,CAC5BC,EAAa,IAAM,CAAC,CACtB,EAAGJ,CAAI,EAEHI,EAAa,IAAY,CACvBT,EAAI,WAAW,OAAS,GAAKM,EAAQ,MAAOI,GAAQ,OAAO,OAAO,OAAQA,CAAG,CAAC,GAAKH,EAAU,MAAOI,GAAaV,EAAEU,CAAQ,CAAC,GAC9H,cAAcH,CAAI,EAClBJ,EAAS,GAET,WAAWK,EAAY,CAAC,CAE5B,EAEAA,EAAW,CACb,ECrBO,IAAMG,EAAa,oDAEbC,EAAcC,GAA6D,CAtBxF,IAAAC,EAAAC,EAuBE,IAAMC,EAAQ,QACd,OAAAH,EAAe,QAAU,CACvB,YAAcI,EAAEN,EAAa,MAAM,EAAuBK,CAAK,EAC/D,KAAOC,EAAEN,EAAa,OAAO,EAAuBK,CAAK,EACzD,QAAUC,EAAE,wBAAwB,EAAuBD,CAAK,EAChE,MAAQC,EAAEN,EAAa,SAAS,EAAuBK,CAAK,EAC5D,MACGC,EAAEN,EAAa,SAAS,EAAuBK,CAAK,IAAM,GACtDC,EAAEN,EAAa,SAAS,EAAuBK,CAAK,EACpDC,EAAEN,EAAa,SAAS,EAAuBK,CAAK,EAC3D,OAAQD,EAAAE,EAAEN,EAAa,QAAQ,IAAvB,YAAAI,EAAgD,SAASD,EAAAG,EAAEN,EAAa,QAAQ,IAAvB,YAAAG,EAAgD,eAAe,IAClI,EACOD,CACT,ECVA,IAAMK,EAAQ,CAACC,EAAM,OAAO,MAAc,CACxC,IAAMC,EAAsBD,EAAI,mBAE5BE,EAAgCD,EAAoB,SAAS,EACjEC,EAAwBA,EAAsB,QAAQ,+BAAgC,qBAAqB,EAE3G,IAAMC,EAAiB,IAAI,SAAS,IAAK,IAAK,IAAK,IAAID,CAAqB,UAAU,EAGtFC,EAAe,OAASF,EAAoB,OAC5CE,EAAe,UAAYF,EAAoB,UAC/CD,EAAI,mBAAqBG,EACzBH,EAAI,KAAOI,EAGXC,EAAI,iBAAiB,6BAA6B,EAAE,QAASC,GAAOH,EAAe,OAAOG,CAAE,CAAC,CAC/F,EAEaC,EAA0B,IAAY,CA5CnD,IAAAC,EAAAC,EA6CE,IAAMC,GAAYF,EAAA,OAAO,SAAS,KAAK,MAAM,kBAAkB,IAA7C,YAAAA,EAAiD,GAC7DG,EAAY,aACZC,EAAgB,gBAChBC,EAAiB,iBAEjBC,EAAS,OAAO,OACpB,CACE,CAACF,CAAa,EAAG,GACjB,CAACC,CAAc,EAAG,EACpB,GACAJ,EAAAJ,EAAI,gBAAJ,YAAAI,EAAmB,OACrB,EAIEC,IAAc,QAEdI,EAAOD,CAAc,EAAE,MAAMF,CAAS,EAAE,SAASD,CAAS,GAEzDI,EAAOF,CAAa,IAAM,IAAM,CAACE,EAAOF,CAAa,EAAE,MAAMD,CAAS,EAAE,SAASD,CAAS,GAK7FK,EAEEhB,EAEA,IAEA,CAAC,IAAK,MAAO,QAAQ,EAErB,CAACiB,EAAa,MAAM,CACtB,CACF,EC5DAC,EAAwB",
  "names": ["doc", "$", "s", "domReady", "callback", "wait", "objects", "selectors", "ctrl", "checkReady", "key", "selector", "addressStr", "addAddress", "billingDetails", "_a", "_b", "value", "$", "patch", "app", "originalConstructor", "serializedConstructor", "newConstructor", "addAddress", "doc", "el", "stripeAddBillingAddress", "_a", "_b", "offerSlug", "separator", "enabledOffers", "disabledOffers", "config", "domReady", "addressStr", "stripeAddBillingAddress"]
}
